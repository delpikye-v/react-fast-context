import{useRef as t,useSyncExternalStore as n}from"react";function e(t){let n=t;const e=new Set;let c=!1,r=!1;function o(){c?r=!0:e.forEach(t=>t())}return{get:function(){return n},set:function(t){const e=structuredClone(n);t(e),n=e,o()},replace:function(t){n=t,o()},batch:function(t){c=!0,t(),c=!1,r&&(r=!1,o())},transaction:function(t){const e=n,s=c,u=r;c=!0,r=!1;try{t(),c=s,!s&&r&&(r=!1,o())}catch(t){throw n=e,c=s,r=u,t}},subscribe:function(t){return e.add(t),()=>e.delete(t)}}}function c(t,n){const e={};for(const c in t){const r=t[c];e[c]=(...t)=>{n(n=>{r(n,...t)})}}return e}function r(e,c){return function(r,o=Object.is){const s=t(),u=t(!1),i=()=>{const t=r(e());return u.current&&o(s.current,t)?s.current:(u.current=!0,s.current=t,t)};return n(c,i,i)}}function o(t){const n=e(t.state),s=r(n.get,n.subscribe);const u=t.actions?c(t.actions,n.set):void 0;return{state:n.get,set:n.set,replace:n.replace,batch:n.batch,transaction:n.transaction,use:s,computed:function(t,e){return{use:()=>s(t,e),value:()=>t(n.get())}},scope:function(n){return o({state:n,actions:t.actions})},subscribe:n.subscribe,devtools:function(t){return n.subscribe(()=>t({state:n.get()}))},actions:u}}function s(t){return function(n,e,c){var r;const o=null!==(r=c.signal)&&void 0!==r?r:(new AbortController).signal;return{payload:n,scope:e,emit:c.emit,signal:o,state:t.get(),setState(n){t.set(n)}}}}export{c as bindActions,s as bindFastContext,o as createFastContext,r as createFastSelector,e as createStore};
