import{useRef as t,useSyncExternalStore as n}from"react";function e(t,n){var e;let r=t;const c=new Set,o=null!==(e=null==n?void 0:n.merge)&&void 0!==e?e:"shallow";let s=!1,u=!1;function i(){s?u=!0:c.forEach(t=>t())}return{get:function(){return r},set:function(t){const n=r,e=structuredClone(n);t(e),r=function(t,n){if("none"===o)return n;const e=structuredClone(n);for(const n in e){const r=t[n],c=e[n];r&&c&&"object"==typeof r&&"object"==typeof c&&!Array.isArray(r)&&!Array.isArray(c)&&"shallow"===o&&(e[n]={...r,...c})}return e}(n,e),i()},replace:function(t){r=t,i()},batch:function(t){s=!0,t(),s=!1,u&&(u=!1,i())},transaction:function(t){const n=r,e=s,c=u;s=!0,u=!1;try{t(),s=e,!e&&u&&(u=!1,i())}catch(t){throw r=n,s=e,u=c,t}},subscribe:function(t){return c.add(t),()=>c.delete(t)}}}function r(t,n){const e={};for(const r in t){const c=t[r];e[r]=(...t)=>{n(n=>{c(n,...t)})}}return e}function c(e,r){return function(c,o=Object.is){const s=t(),u=t(!1),i=()=>{const t=c(e());return u.current&&o(s.current,t)?s.current:(u.current=!0,s.current=t,t)};return n(r,i,i)}}function o(t){var n;const s=e(t.state,{merge:null!==(n=t.merge)&&void 0!==n?n:"shallow"}),u=c(s.get,s.subscribe);function i(t,n){let e=t(s.get());return{use:()=>u(t,n),value:()=>t(s.get()),subscribe:function(r){return s.subscribe(()=>{const c=t(s.get());(n?n(e,c):c===e)||(e=c,r(c))})}}}const a=t.actions?r(t.actions,s.set):void 0;return{state:s.get,set:s.set,replace:s.replace,batch:s.batch,transaction:s.transaction,subscribe:s.subscribe,when:function(t,n){let e=!1;return s.subscribe(()=>{if(e)return;const r=s.get(),c=t(r);c&&(e=!0,n(c,r))})},devtools:function(t){return s.subscribe(()=>t({state:s.get()}))},computed:i,select:i,scope:function(n,e){return o({state:n,actions:t.actions,merge:null==e?void 0:e.merge})},use:u,actions:a}}function s(t){return function(n,e,r){var c;const o=null!==(c=r.signal)&&void 0!==c?c:(new AbortController).signal;return{payload:n,scope:e,emit:r.emit,signal:o,state:t.get(),setState(n){t.set(n)}}}}export{r as bindActions,s as bindFastContext,o as createFastContext,c as createFastSelector,e as createStore};
