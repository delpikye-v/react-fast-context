import{useRef as t,useSyncExternalStore as n}from"react";function e(t,n){var e;let r=t;const o=new Set,c=null!==(e=null==n?void 0:n.merge)&&void 0!==e?e:"shallow";let s=!1,u=!1;function i(){s?u=!0:o.forEach(t=>t())}return{get:function(){return r},set:function(t){const n=r,e=structuredClone(n);t(e),r=function(t,n){if("none"===c)return n;const e=structuredClone(n);for(const n in e){const r=t[n],o=e[n];r&&o&&"object"==typeof r&&"object"==typeof o&&!Array.isArray(r)&&!Array.isArray(o)&&"shallow"===c&&(e[n]={...r,...o})}return e}(n,e),i()},replace:function(t){r=t,i()},batch:function(t){s=!0,t(),s=!1,u&&(u=!1,i())},transaction:function(t){const n=r,e=s,o=u;s=!0,u=!1;try{t(),s=e,!e&&u&&(u=!1,i())}catch(t){throw r=n,s=e,u=o,t}},subscribe:function(t){return o.add(t),()=>o.delete(t)}}}function r(t,n){const e={};for(const r in t){const o=t[r];e[r]=(...t)=>{n(n=>{o(n,...t)})}}return e}function o(e,r){return function(o,c=Object.is){const s=t(),u=t(!1),i=()=>{const t=o(e());return u.current&&c(s.current,t)?s.current:(u.current=!0,s.current=t,t)};return n(r,i,i)}}function c(t){var n;const s=e(t.state,{merge:null!==(n=t.merge)&&void 0!==n?n:"shallow"}),u=o(s.get,s.subscribe);const i=t.actions?r(t.actions,s.set):void 0;return{state:s.get,set:s.set,replace:s.replace,batch:s.batch,transaction:s.transaction,computed:function(t,n){return{use:()=>u(t,n),value:()=>t(s.get())}},scope:function(n){return c({state:n,actions:t.actions})},subscribe:s.subscribe,devtools:function(t){return s.subscribe(()=>t({state:s.get()}))},use:u,actions:i}}function s(t){return function(n,e,r){var o;const c=null!==(o=r.signal)&&void 0!==o?o:(new AbortController).signal;return{payload:n,scope:e,emit:r.emit,signal:c,state:t.get(),setState(n){t.set(n)}}}}export{r as bindActions,s as bindFastContext,c as createFastContext,o as createFastSelector,e as createStore};
