import{useSyncExternalStore as t,useRef as n}from"react";function e(n){var e;const r=createStore(n.state,{merge:null!==(e=n.merge)&&void 0!==e?e:"shallow"});const o=n.actions?bindActions(n.actions,r.set):void 0;return{get state(){return r.get()},set:r.set,replace:r.replace,batch:r.batch,transaction:r.transaction,subscribe:r.subscribe,devtools:function(t){return r.subscribe(()=>t({state:r.get()}))},use:function(n){return t(r.subscribe,()=>{const t=r.get();return n?n(t):t},()=>{const t=r.get();return n?n(t):t})},actions:o}}function r(t,n){var e;let r=t;const o=new Set,c=null!==(e=null==n?void 0:n.merge)&&void 0!==e?e:"shallow";let s=!1,u=!1;function i(){s?u=!0:o.forEach(t=>t())}return{get:function(){return r},set:function(t){const n=r,e=structuredClone(r);t(e),r=function(t,n){if("none"===c)return n;const e=structuredClone(n);for(const n in e){const r=t[n],o=e[n];r&&o&&"object"==typeof r&&"object"==typeof o&&!Array.isArray(r)&&!Array.isArray(o)&&"shallow"===c&&(e[n]={...r,...o})}return e}(n,e),i()},replace:function(t){r=t,i()},batch:function(t){s=!0,t(),s=!1,u&&(u=!1,i())},transaction:function(t){const n=r,e=s,o=u;s=!0,u=!1;try{t(),s=e,!e&&u&&(u=!1,i())}catch(t){throw r=n,s=e,u=o,t}},subscribe:function(t){return o.add(t),()=>o.delete(t)}}}function o(t,n){const e={};for(const r in t){const o=t[r];e[r]=(...t)=>{n(n=>{o(n,...t)})}}return e}function c(e,r){return function(o,c=Object.is){const s=n(),u=n(!1),i=()=>{const t=o(e());return u.current&&c(s.current,t)?s.current:(u.current=!0,s.current=t,t)};return t(r,i,i)}}function s(t){return function(n,e,r){var o;const c=null!==(o=r.signal)&&void 0!==o?o:(new AbortController).signal;return{payload:n,scope:e,emit:r.emit,signal:c,state:t.get(),setState(n){t.set(n)}}}}export{o as bindActions,s as bindFastContext,e as createFastContext,c as createFastSelector,r as createStore};
